# 功能規格：imrbs 會議室預約系統

**Feature Branch**: `1-imrbs-app`
**Created**: 2025-11-03
**Status**: Draft

> 注意：本專案所有規格文件以中文撰寫。若涉及資料儲存，系統預設以 JSON 作為持久化格式；若需採用其他儲存方式，必須在下方 Storage/Requirements 區段說明理由與遷移策略。

## 摘要
建立名為「imrbs」的會議室預約系統應用程式，提供會議室查詢、預約登錄/修改、衝突檢查、預約成功通知（email）以及會議室管理功能。系統初始會議室清單如下：

- 板橋
  - 6樓 太平洋會議室
  - 7樓 711會議室
  - 7樓 701會議室
- 民生
  - 301會議室
  - 310會議室

目標：以可測試、使用者友善且可維護的方式交付核心預約功能，並以 JSON 持久化儲存資料。

## 使用者情境與測試（必填）

### 使用情境 1 - 建立預約（P1）
使用者（會議召集人）希望為某會議室建立預約。

Acceptance:
1. 使用者在 UI 選擇地點、會議室、日期、開始/結束時間、會議主題、參與者（email 列表）及聯絡 email。
2. 系統在提交時執行衝突檢查；若無衝突，建立預約並回傳成功；若有衝突，回傳衝突訊息並提示可用時段。
3. 成功建立後，系統發送確認 email 到預約者（聯絡 email）。

可獨立測試：對 API/服務呼叫建立預約流程，檢查 DB/JSON 中是否新增紀錄、衝突情境是否被拒絕，以及是否有發出 email 事件（可使用測試替身/mock）。

### 使用情境 2 - 修改/取消預約（P1）
預約建立後，預約者可修改或取消預約，系統需再次執行衝突檢查（若變更時間）。修改成功後發送更新或取消通知 email。

Acceptance:
1. 修改時間範圍時系統須檢查衝突；若衝突則拒絕修改並回傳原因。
2. 取消時系統標記該預約為已取消並發送取消通知 email。

### 使用情境 3 - 檢視會議室清單與狀態（P1）
使用者可看到各會議室當日或指定日期的預約狀態（空閒/已預約/保留）。

Acceptance:
1. 使用者能選擇日期與地點，系統顯示該日期每間會議室的時段占用狀態。

### 使用情境 4 - 管理會議室（P2）
管理員可新增/編輯/移除會議室（名稱、所在樓層、容量、是否需審核等屬性）。

Acceptance:
1. 管理員執行新增/編輯/刪除後，會議室列表更新並持久化到 JSON 儲存層。

## 邊界與例外情境

- 若預約跨午夜或橫跨多個日曆日，系統視為多個日區段處理（需在 UI/規格中明確表示是否允許）。
- 若傳入時間格式不合法，回傳驗證錯誤。
- 若 email 無效，系統應拒絕並提示聯絡人需提供有效 email。

## 功能需求（可測試）

- FR-001: 系統 MUST 允許使用者建立新預約，必要欄位：location, room_id, date, start_time, end_time, organizer_email, title。
- FR-002: 系統 MUST 在建立或修改預約時執行衝突檢查，拒絕與現有已確認（非取消）預約時間重疊的請求。
- FR-003: 系統 MUST 提供查詢 API/介面，列出指定日期與地點下每間會議室的時段狀態（空閒/已預約/取消）。
- FR-004: 預約建立或修改成功後，系統 MUST 發送 email 通知到 organizer_email（郵件內容包含預約摘要與編號）。
- FR-005: 系統 MUST 支援預約的修改與取消流程，並在取消時將狀態標為已取消且發送取消通知。
- FR-006: 系統 MUST 提供管理員介面或 API 以新增/編輯/刪除會議室資訊，變更需立即持久化至 JSON 儲存。
- FR-007: 所有輸入資料 MUST 經過驗證（時間順序、email 格式、必填欄位）。
- FR-008: 所有持久化資料 MUST 儲存為 JSON 格式檔案（或相容 JSON 的儲存介面），並包含 schema version 欄位以供未來遷移使用。

## 關鍵實體

- 會議室 (Room): id, name, location（板橋/民生）, floor, capacity, metadata
- 預約 (Reservation): id, room_id, date, start_time, end_time, title, organizer_email, participants, status (confirmed/cancelled), created_at, updated_at, schema_version
- 使用者/聯絡人 (UserContact): email, name (可選)

## 非功能性需求（NFR）

- NFR-001: 系統回應時間（使用者提交預約後）應在 5 秒內給予成功或失敗回覆（在測試環境可模擬）。
- NFR-002: 衝突檢查邏輯必須有單元測試與整合測試覆蓋常見邊界（緊接時間段、完全覆蓋、跨日段）。
- NFR-003: Email 發送應支援測試替身以便在 CI 中驗證發送事件，而非實際寄送。

## Storage / Requirements

- 預計採用 JSON 檔案做為初期持久化（符合憲章「持久化 JSON 儲存」原則）。
- JSON schema 必須包含 schema_version 欄位。例：

```json
{
  "schema_version": "1",
  "reservations": []
}
```

- 需提供備份/還原與簡單的遷移指引（在 spec 的實作計畫中補充）。

## Success Criteria（可衡量、與使用者相關）

- SC-001: 使用者能在 UI/API 上完成預約建立流程（含衝突檢查）並在接受測試場景中達成 100% 的正確拒絕衝突請求。
- SC-002: 在模擬/測試環境中，預約建立後可觀察到對應的 JSON 記錄寫入，且 schema_version 正確填寫。
- SC-003: 在測試條件下，建立/修改/取消預約時系統會產生對應的 email 事件（可由 mock 驗證）。
- SC-004: 主要使用流程在 90% 的測試請求中能於 5 秒內回應。

## 假設 (Assumptions)

- 初期使用者管理簡化為以 email 作為預約者識別，不實作完整使用者帳號系統（可在後續版本擴充）。
- 初期只支援在單一地點/會議室內的簡單時段預約（不支援複雜重複規則，除非另行規格）。

## 依賴

- 必要：能在 CI/CD 中以 mock/stub 模擬 email 發送與 JSON 檔案存取。

## Acceptance Tests（建議最少測試用例）

- 建立成功：在空閒時段建立預約 -> 成功、JSON 中新增紀錄、發出 email 事件。
- 衝突拒絕：建立與現有 confirmed 預約重疊的請求 -> 失敗並回傳衝突資訊。
- 修改時段衝突：修改為與其他預約重疊 -> 拒絕。
- 取消預約：取消後狀態變更為 cancelled，並發送取消通知事件。
- 會議室管理：新增一間會議室 -> 會議室列表更新且持久化。


---

*Spec draft 完成。下一步：建立 feature branch (1-imrbs-app) 並進入 /speckit.plan 以產出實作計畫。*
